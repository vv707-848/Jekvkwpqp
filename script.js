// بيانات العقارات المحلية (من ملف script.js الأصلي - جميع العقارات الحقيقية)
const properties = [
  {
    "category": "عمائر",
    "description": "📍 عمارة سكنية للبيع في حي نخب – الطائف\n🔹 المواصفات:\n✔ صك إلكتروني\nمساحة الأرض 400\nالمبنى 250\nالباقي احواش\n✔ دورين مستقلين، التفاصيل كالتالي:\nالدور الأول:\n5 غرف واسعة\n3 دورات مياه\nمطبخ وصالات رحبة\nمدخل مستقل + مدخل مشترك مع الدور الثاني\nمدخل إضافي من الواجهة الشرقية\nالدور الثاني:\n4 غرف واسعة\n3 دورات مياه\nمطبخ واسع\nصالتان فسيحتان\nغرفة خامسة غير مسقوفة (حوش) بإطلالة رائعة على حي السحيلي ومخطط البيعة وغرب الطائف\nمدخل منفصل من الواجهة الجنوبية\n✔ واجهتان شرقية وغربية مع ميدان في الجهة الشرقية\n✔ عمر العقار: 16 سنة\n🏠 العمارة مؤجرة بالكامل بـ 30,000 ريال سنويًا\n📍 الموقع: حي نخب – مقابل خزان المياه\n🏞 إطلالة بانورامية رائعة على مدينة الطائف\n💰 السعر المطلوب: 1,300,000 ريال صافي (يشمل الرهن العقاري البالغ 250,000 ريال)\n🔹 المطلوب دفع المبلغ كاش لسداد الرهن",
    "id": 1,
    "images": [
      "https://via.placeholder.com/800x600?text=Property+1+Image+1",
      "https://via.placeholder.com/800x600?text=Property+1+Image+2",
      "https://via.placeholder.com/800x600?text=Property+1+Image+3",
      "https://via.placeholder.com/800x600?text=Property+1+Image+4",
      "https://via.placeholder.com/800x600?text=Property+1+Image+5"
    ],
    "location": "الطائف - حي نخب ",
    "mainImage": "https://via.placeholder.com/800x600?text=Property+1+Main+Image",
    "price": "1300000 ريال ",
    "title": "عمارة دورين منفصلة ",
    "updatedAt": 1740768031144
  },
  {
    "category": "عمائر",
    "description": "📢 عمارة للبيع في مخطط القاضي – الطائف\n📍 الموقع: حي الصيانة، بعد حي الحلقة الشرقية\n🏡 المساحة: 600 متر مربع\nعلى شارعين:\nشارع 25 متر شرقًا\nشارع 20 متر شمالًا\nإيجار الشقق 150 الف تقريباً\nمن غير الدور الخاص غير مؤجر\n🔹 مواصفات العمارة:\nعدد الأدوار: 4 أدوار + ملحق\nبدروم مكون من شقتين:\nكل شقة بمدخل مستقل\nغرفة وحمام ومطبخ للسائق\nغرفة خادمة مع حمام غسيل\nالدور الأول (خاص):\nمجلس رجال (8.6 م × 5 م)\nمقلط (صالة طعام) 9 م × 6 م\nمجلس نساء\nصالة جلوس واسعة\n3 غرف نوم\n4 حمامات\nمطبخ\nملحق في الحوش الخاص بالدور\nحوش مطل على المطبخ\nمدخلين (رجال ونساء) + مدخل سيارة\nالدور الثاني: شقتان\nالدور الثالث: شقتان\nالدور الرابع: ملحق مع السطح\nكل شقة مكونة من 4 غرف، 3 حمامات، مدخلين\nمدخل الشقق على شارع 20\nيوجد مصعد\n🔴 يوجد لها صك 📄\n🏠 حالة العقار: جديدة، عمرها 7 سنوات\n💰 جميع الشقق مؤجرة باستثناء الدور الأول (خاص)\n🏦 عليها تمويل من بنك التنمية العقارية بقيمة 340,000 ريال\n📌 السعر المطلوب: 3,500,000 ريال (غير قابل للتفاوض)",
    "id": 6,
    "images": [
      "https://via.placeholder.com/800x600?text=Property+6+Image+1",
      "https://via.placeholder.com/800x600?text=Property+6+Image+2",
      "https://via.placeholder.com/800x600?text=Property+6+Image+3",
      "https://via.placeholder.com/800x600?text=Property+6+Image+4",
      "https://via.placeholder.com/800x600?text=Property+6+Image+5",
      "https://via.placeholder.com/800x600?text=Property+6+Image+6",
      "https://via.placeholder.com/800x600?text=Property+6+Image+7",
      "https://via.placeholder.com/800x600?text=Property+6+Image+8",
      "https://via.placeholder.com/800x600?text=Property+6+Image+9",
      "https://via.placeholder.com/800x600?text=Property+6+Image+10"
    ],
    "location": "الطائف- الحلقة الشرقية ",
    "mainImage": "https://via.placeholder.com/800x600?text=Property+6+Main+Image",
    "price": "3500000 ريال ",
    "title": "عمارة 4 ادوار وملحق ",
    "updatedAt": 1740778691579
  },
  {
    "category": "عمائر",
    "description": " عماره جديده للبيع في ريحه\nمساحه 500\n300 البناء تقريباً\n🔴 لا تقبل البنك لانها بدون صك حالياً مرفوعه على منصة احكام في المرحلة الاخيرة 🔴\nعمر العقار 4 سنوات\nالعماره علي ثلاث ادوار ،،،دور الاول جاهز ودور الثاني شقتين عظم\nأدور ثالث لايوجد الأساسات الي في صبه والعمارة علي واجهتين\nتفاصيل العماره\nمدخل ،،،مجلس حريم مع دوره مياه\nصاله وغرفه غسيل ،مطبخ ومستودع ،\nغرفه مع دوره مياه جناح خاص\nغرفتين مع دوره مياه جناح خاص\nغرفتين مع دوره مياه جناح خاص\nمجلس الرجال 7/في 6مستقل في الحوش /يوجد ديوانية جاهزه 5في5مع دوره مياه\nيوجد حوش ومدخل لسياره ومدخل خاص الرجال\nالمطلوب 800 الف ريال 🔴",
    "id": 8,
    "images": [
      "https://via.placeholder.com/800x600?text=Property+8+Image+1",
      "https://via.placeholder.com/800x600?text=Property+8+Image+2",
      "https://via.placeholder.com/800x600?text=Property+8+Image+3",
      "https://via.placeholder.com/800x600?text=Property+8+Image+4",
      "https://via.placeholder.com/800x600?text=Property+8+Image+5",
      "https://via.placeholder.com/800x600?text=Property+8+Image+6"
    ],
    "location": "الطائف- ريحة",
    "mainImage": "https://via.placeholder.com/800x600?text=Property+8+Main+Image",
    "price": "800000 ريال",
    "title": "عمارة دور وشقتين عظم ",
    "updatedAt": 1740779362105
  },
  {
    "category": "عمائر",
    "description": "🏢 فرصة استثمارية مميزة – عمارة سكنية فاخرة\nالسعر: 2,800,000 ريال (قابل للتفاوض)\nالموقع: جبل المفتي شهار\n📐 المواصفات الرئيسية\nالمساحة: 524 م²\nالأدوار: 3 أدوار + بدروم + ملحق + سطح\nالشقق: 5 شقق بتصميم أنيق\nالمصعد: أوتوماتيكي (فوجي الإيطالية - سعة 8 أشخاص)\nالتفاصيل\nالبدروم: مواقف سيارات، غرفة حارس، مستودع\nالشقق:\nالدور الاول: شقتان صغيرتان (غرفتين، صالتين، مطبخ)\nالدور الثاني :شقتان أنيقتان (4 غرف، 3 دورات مياه، صالة، مطبخ)\nالدور الثالث :شقة متكاملة (4 أجنحة، مجلس، مطبخ كبير، 4 دورات مياه)\nالملحق: مجلس كبير، صالة شعبية مع مشب، مغاسل\nالسطح: بيت شعر، جلسة خارجية، أوفس\n✅ المميزات\nمدخلين لكل شقة\nخزانين كبيرين للماء والصرف\nتوصيل خدمات متكامل (ماء، صرف، كهرباء)\nبناء مصبوب باللبشة (حديد سابك، مواد عالية الجودة)\nضمان شامل على العمارة والتشطيبات\n💼 لماذا تشتري هذه العمارة؟\nموقع مميز في جبل المفتي شهار\nتصميم فاخر ومرافق متكاملة\nعائد استثماري ممتاز (5 شقق للإيجار)",
    "id": 10,
    "images": [
      "https://via.placeholder.com/800x600?text=Property+10+Image+1",
      "https://via.placeholder.com/800x600?text=Property+10+Image+2",
      "https://via.placeholder.com/800x600?text=Property+10+Image+3",
      "https://via.placeholder.com/800x600?text=Property+10+Image+4",
      "https://via.placeholder.com/800x600?text=Property+10+Image+5",
      "https://via.placeholder.com/800x600?text=Property+10+Image+6",
      "https://via.placeholder.com/800x600?text=Property+10+Image+7",
      "https://via.placeholder.com/800x600?text=Property+10+Image+8",
      "https://via.placeholder.com/800x600?text=Property+10+Image+9",
      "https://via.placeholder.com/800x600?text=Property+10+Image+10"
    ],
    "location": "الطائف- شهار - جبل المفتي ",
    "mainImage": "https://via.placeholder.com/800x600?text=Property+10+Main+Image",
    "price": "2800000",
    "title": "عمارة شقق 3 أدوار وملحق",
    "updatedAt": 1740779751386
  },
  {
    "category": "شقق",
    "description": "للبيع شقق تمليك في مخطط الفهد – حي مثملة\n📍 الموقع: خلف مستوصف البندر كلينك\nالدور الارضي تم بيعه\n🏡 المواصفات:\nالمساحة: 191 متر مربع\n4 غرف واسعة\nصالة مريحة\nمطبخ مستقل\nمستودع عملي\n3 دورات مياه\n💰 السعر المطلوب: 530,000 ريال فيه تفاوض ",
    "id": 11,
    "images": [
      "https://via.placeholder.com/800x600?text=Property+11+Image+1",
      "https://via.placeholder.com/800x600?text=Property+11+Image+2",
      "https://via.placeholder.com/800x600?text=Property+11+Image+3",
      "https://via.placeholder.com/800x600?text=Property+11+Image+4",
      "https://via.placeholder.com/800x600?text=Property+11+Image+5",
      "https://via.placeholder.com/800x600?text=Property+11+Image+6",
      "https://via.placeholder.com/800x600?text=Property+11+Image+7",
      "https://via.placeholder.com/800x600?text=Property+11+Image+8",
      "https://via.placeholder.com/800x600?text=Property+11+Image+9",
      "https://via.placeholder.com/800x600?text=Property+11+Image+10",
      "https://via.placeholder.com/800x600?text=Property+11+Image+11",
      "https://via.placeholder.com/800x600?text=Property+11+Image+12"
    ],
    "location": "الطائف- مثملة - مخطط الفهد ",
    "mainImage": "https://via.placeholder.com/800x600?text=Property+11+Main+Image",
    "price": "530000 ريال ",
    "title": "شقق",
    "updatedAt": 1740780079356
  },
  {
    "category": "أدوار مستقلة",
    "description": "🏡 دور للبيع في الدور الاول في الحلقة الغربية – موقع مميز بالقرب من العثيم 🏡\n🔹 الموقع: الحلقة الغربية – قريب من العثيم\n🔹 المساحة: حوالي 375 م²\n🔹 المواصفات:\n✔ عدد الغرف: 8 غرف واسعة\n✔ الصالة: كبيرة بمقاس 8×6 م\n✔ عدد دورات المياه: 4\n✔ المطبخ: واسع ومجهز\n✔ مشب في الحوش للاستمتاع بجلسات رائعة\n✔ الحوش: حوشين مستقلين\n🔹 المرافق والخدمات:\n✅ عداد كهرباء خاص\n✅ خزان مياه خاص\n✅ المياه والصرف الصحي متوفران\n✅ 3 مداخل خاصة لخصوصية أكثر\n✅ واجهتين مميزتين\n💰 السعر المطلوب: 800 ألف شامل البنك (صافي)\n🏦 عليه 560 ألف بنك الراجحي",
    "id": 12,
    "images": [
      "https://via.placeholder.com/800x600?text=Property+12+Image+1",
      "https://via.placeholder.com/800x600?text=Property+12+Image+2",
      "https://via.placeholder.com/800x600?text=Property+12+Image+3",
      "https://via.placeholder.com/800x600?text=Property+12+Image+4",
      "https://via.placeholder.com/800x600?text=Property+12+Image+5",
      "https://via.placeholder.com/800x600?text=Property+12+Image+6",
      "https://via.placeholder.com/800x600?text=Property+12+Image+7",
      "https://via.placeholder.com/800x600?text=Property+12+Image+8",
      "https://via.placeholder.com/800x600?text=Property+12+Image+9",
      "https://via.placeholder.com/800x600?text=Property+12+Image+10",
      "https://via.placeholder.com/800x600?text=Property+12+Image+11",
      "https://via.placeholder.com/800x600?text=Property+12+Image+12",
      "https://via.placeholder.com/800x600?text=Property+12+Image+13",
      "https://via.placeholder.com/800x600?text=Property+12+Image+14",
      "https://via.placeholder.com/800x600?text=Property+12+Image+15",
      "https://via.placeholder.com/800x600?text=Property+12+Image+16",
      "https://via.placeholder.com/800x600?text=Property+12+Image+17",
      "https://via.placeholder.com/800x600?text=Property+12+Image+18",
      "https://via.placeholder.com/800x600?text=Property+12+Image+19"
    ],
    "location": "الطائف- الحلقة الغربية ",
    "mainImage": "https://via.placeholder.com/800x600?text=Property+12+Main+Image",
    "price": "800000 ريال ",
    "title": "دور في عمارة ",
    "updatedAt": 1740780264994
  },
  {
    "category": "عمائر",
    "description": "🏢 للبيع – عمارة سكنية استثمارية بموقع مميز!\n📍 الموقع: على شارعين، مسجلة في منصة إحكام لا تقبل البنك 🔴\n📏 المساحة: 800 متر مربع\nالعمر قريب من 20 سنة\nبدون صك 🔴 \n🏗️ عدد الأدوار: 3 أدوار + قسم منفصل للعمالة\n💰 المطلوب: آخر سومة مليون ريال🔴\n🔹 تفاصيل العقار:\n✅ الدور الأول:\nشقة 1: 3 غرف، حمام، صالة، مطبخ، مدخلين\nشقة 2: 2 غرفة، 2 حمام، صالة، مطبخ، مدخلين\n✅ الدور الثاني:\nشقة 1: 4 غرف، 2 حمام، صالة، مطبخ\nشقة 2: 4 غرف، 2 حمام، صالة، مطبخ\n✅ الدور الثالث (نظام فيلا):\n4 غرف، حمام، مطبخ، صالة كبيرة\nسطح خاص بالشقة + سطح ثاني خاص بالعمارة\n✅ قسم منفصل في الحوش:\n9 غرف، لكل غرفة حمام مستقل وخدمات متكاملة\n📌 💡 العقار مناسب للسكن والاستثمار، بتوزيع عملي وتصميم يوفر خصوصية لجميع الوحدات.",
    "id": 13,
    "images": [
      "https://via.placeholder.com/800x600?text=Property+13+Image+1",
      "https://via.placeholder.com/800x600?text=Property+13+Image+2"
    ],
    "location": "الطائف- ريحة ",
    "mainImage": "https://via.placeholder.com/800x600?text=Property+13+Main+Image",
    "price": "1000000 ريال",
    "title": "عمارة شقق 3 أدوار ",
    "updatedAt": 1740780463759
  },
  {
    "category": "عمائر",
    "description": "العقار عبارة عن دورين وملحق، يتميز بالتصميم المنفصل بين الدور الأرضي والدور الأول والملحق، مع تفاصيله كالتالي:\nتفاصيل العقار:\n• مساحة الأرض: 667 متر مربع.\n• مساحة البناء: 538 متر مربع.\nالدور الأرضي:\n• 3 مداخل.\n• 3 غرف نوم مع دورات مياه.\n• صالتان.\n• مجلس نساء ومجلس رجال.\n• مقلط.\n• صالة طعام ومطبخ مغلق.\n• مجلس خارجي (ملحق) مع جلسة خارجية ومزرعة.\n• مدخل كراج.\n• مستودع وغرفة غسيل وغرفة خادمة.\nالدور الأول:\n• 3 مداخل.\n• حوش.\n• 3 غرف نوم مع دورة مياه لكل غرفة.\n• مجلس نساء ومجلس رجال.\n• مقلط.\n• مطبخ مغلق.\n• صالة.\n• صالة طعام.\nالملحق:\n• مدخلان.\n• غرفة نوم مع دورة مياه.\n• مجلس نساء ومجلس رجال مع دورة مياه.\n• صالة.\n• مطبخ مركب وجاهز.\n• سطح خاص.\nمعلومات إضافية:\n• عمر العقار أكثر من 20 سنة.\n• المطلوب: 1,600,000 ريال صافي شامل الرهن.\n• عليه رهن من البنك العربي بقيمة 348,000 ريال.",
    "id": 14,
    "images": [
      "https://via.placeholder.com/800x600?text=Property+14+Image+1",
      "https://via.placeholder.com/800x600?text=Property+14+Image+2",
      "https://via.placeholder.com/800x600?text=Property+14+Image+3",
      "https://via.placeholder.com/800x600?text=Property+14+Image+4",
      "https://via.placeholder.com/800x600?text=Property+14+Image+5",
      "https://via.placeholder.com/800x600?text=Property+14+Image+6",
      "https://via.placeholder.com/800x600?text=Property+14+Image+7",
      "https://via.placeholder.com/800x600?text=Property+14+Image+8",
      "https://via.placeholder.com/800x600?text=Property+14+Image+9",
      "https://via.placeholder.com/800x600?text=Property+14+Image+10",
      "https://via.placeholder.com/800x600?text=Property+14+Image+11",
      "https://via.placeholder.com/800x600?text=Property+14+Image+12",
      "https://via.placeholder.com/800x600?text=Property+14+Image+13",
      "https://via.placeholder.com/800x600?text=Property+14+Image+14",
      "https://via.placeholder.com/800x600?text=Property+14+Image+15",
      "https://via.placeholder.com/800x600?text=Property+14+Image+16",
      "https://via.placeholder.com/800x600?text=Property+14+Image+17",
      "https://via.placeholder.com/800x600?text=Property+14+Image+18",
      "https://via.placeholder.com/800x600?text=Property+14+Image+19",
      "https://via.placeholder.com/800x600?text=Property+14+Image+20",
      "https://via.placeholder.com/800x600?text=Property+14+Image+21",
      "https://via.placeholder.com/800x600?text=Property+14+Image+22"
    ],
    "location": "الطائف- الحلقة الشرقية ",
    "mainImage": "https://via.placeholder.com/800x600?text=Property+14+Main+Image",
    "price": "1600000 ريال ",
    "title": "عمارة دورين وملحق ",
    "updatedAt": 1740780595151
  },
  {
    "category": "أدوار مستقلة",
    "description": "للبيع – فرصة عقارية مميزة! 🏡🔥\n🔹 البناء شخصي وجديد – تشطيب راقٍ وجودة عالية\n🔹 موقع مميز في حي الرحاب (المربع الذهبي) – على شارع 15، مرفوع في منصة إحكام وفي المرحلة الأخيرة\n🔴 مؤسسة على 4 ادوار دور والأدوار الأخرى شقتين لكل دور 🔴\n🔹 المساحة: 733 م²، بمسطح بناء 470 م²\n🔹 الدور الأول:\nمجلس رجال (5.60 × 7) + مقلط (5 × 7)\nمجلس نساء (5.50 × 5.50) + صالة واسعة (5.50 × 6.50)\n4 غرف نوم (2 بحجم 4 × 5، وواحدة ماستر 5 × 6، وواحدة 5 × 5)\n4 دورات مياه\nمطبخ (4 × 5) مع مستودع (3 م)\n🔹 الدور الثاني: شقتان تحتاجان فقط لصب سقف\n🔹 مؤسس لأربع أدوار\n🔹 3 مداخل خارجية (مدخل رئيسي – مدخل للشقق – مدخل خاص بالنساء) + كراج سيارة\n🔹 تم تركيب مكيفات سبليت لكامل الفيلا + مطبخ جاهز\n🔴 السوم 750 ألف والبيع قريب 🔴\n🔴🔴 الحد 950 الف قابل للتفاوض 🔴🔴",
    "id": 15,
    "images": [
      "https://via.placeholder.com/800x600?text=Property+15+Image+1"
    ],
    "location": "الطائف- رحاب ",
    "mainImage": "https://via.placeholder.com/800x600?text=Property+15+Main+Image",
    "price": "900000 ",
    "title": "دور مستقل ",
    "updatedAt": 1740780794401
  }
];

// بيانات الإدارة
const ADMIN_USERNAME = "ivl511";
const ADMIN_PASSWORD = "Wa@055364";

// متغيرات حالة الموقع
let isAdminLoggedIn = false;
let filteredProperties = [...properties];

// عند تحميل الصفحة
document.addEventListener('DOMContentLoaded', function() {
    console.log('تم تحميل الصفحة - عدد العقارات:', properties.length);
    
    // عرض العقارات فور تحميل الصفحة
    displayProperties();
    
    // إعداد البحث
    setupSearch();
    
    // إخفاء شاشة التحميل
    const loadingElement = document.getElementById('loadingProperties');
    if (loadingElement) {
        loadingElement.style.display = 'none';
    }
    
    console.log('تم الانتهاء من إعداد الموقع');
});

// إعداد البحث
function setupSearch() {
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.trim();
            searchProperties(searchTerm);
        });
    }
}

// وظيفة البحث
function searchProperties(searchTerm) {
    if (!searchTerm) {
        filteredProperties = [...properties];
    } else {
        const lowerSearchTerm = searchTerm.toLowerCase();
        filteredProperties = properties.filter(property => 
            property.title.toLowerCase().includes(lowerSearchTerm) ||
            property.location.toLowerCase().includes(lowerSearchTerm) ||
            property.price.toLowerCase().includes(lowerSearchTerm) ||
            property.description.toLowerCase().includes(lowerSearchTerm) ||
            property.category.toLowerCase().includes(lowerSearchTerm)
        );
    }
    displayProperties();
}

// عرض العقارات
function displayProperties() {
    const container = document.getElementById('propertiesContainer');
    if (!container) {
        console.error('لم يتم العثور على عنصر propertiesContainer');
        return;
    }
    
    container.innerHTML = '';
    
    if (filteredProperties.length === 0) {
        container.innerHTML = '<div class="col-12 text-center"><p class="text-muted">لا توجد عقارات مطابقة للبحث</p></div>';
        return;
    }
    
    console.log('عرض العقارات - العدد:', filteredProperties.length);
    
    filteredProperties.forEach(property => {
        const propertyCard = createPropertyCard(property);
        container.appendChild(propertyCard);
    });
}

// إنشاء بطاقة عقار
function createPropertyCard(property) {
    const col = document.createElement('div');
    col.className = 'col-lg-4 col-md-6 mb-4';
    
    col.innerHTML = `
        <div class="card property-card h-100" onclick="showPropertyDetail(${property.id})">
            <div class="badge badge-category">${property.category}</div>
            <img src="${property.mainImage}" class="card-img-top" alt="${property.title}" loading="lazy">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title">${property.title}</h5>
                <p class="card-text"><i class="bi bi-geo-alt-fill text-danger"></i> ${property.location}</p>
                <p class="card-text text-success fw-bold"><i class="bi bi-currency-exchange"></i> ${property.price}</p>
                <div class="mt-auto">
                    <button class="btn btn-primary w-100">عرض التفاصيل</button>
                </div>
            </div>
        </div>
    `;
    
    return col;
}

// تصفية العقارات حسب النوع
function filterProperties(category) {
    if (category === 'all') {
        filteredProperties = [...properties];
    } else {
        filteredProperties = properties.filter(property => property.category === category);
    }
    displayProperties();
    
    // التمرير إلى قسم العقارات
    scrollToProperties();
}

// التمرير إلى قسم العقارات
function scrollToProperties() {
    const propertiesSection = document.getElementById('publicContent');
    if (propertiesSection) {
        propertiesSection.scrollIntoView({ behavior: 'smooth' });
    }
}

// عرض تفاصيل العقار
function showPropertyDetail(propertyId) {
    const property = properties.find(p => p.id === propertyId);
    if (!property) {
        console.error('لم يتم العثور على العقار بالمعرف:', propertyId);
        return;
    }
    
    const detailPage = document.getElementById('propertyDetailPage');
    const publicContent = document.getElementById('publicContent');
    const detailContent = document.getElementById('detailContent');
    
    if (!detailPage || !publicContent || !detailContent) {
        console.error('لم يتم العثور على العناصر المطلوبة لعرض التفاصيل');
        return;
    }
    
    // إخفاء المحتوى العام وإظهار صفحة التفاصيل
    publicContent.style.display = 'none';
    detailPage.style.display = 'block';
    
    // إنشاء معرض الصور
    let imagesCarousel = '';
    if (property.images && property.images.length > 0) {
        imagesCarousel = `
            <div id="propertyCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
                <div class="carousel-inner">
                    ${property.images.map((image, index) => `
                        <div class="carousel-item ${index === 0 ? 'active' : ''}">
                            <img src="${image}" class="d-block w-100" alt="صورة العقار ${index + 1}" loading="lazy">
                        </div>
                    `).join('')}
                </div>
                ${property.images.length > 1 ? `
                    <button class="carousel-control-prev" type="button" data-bs-target="#propertyCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#propertyCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                    </button>
                ` : ''}
            </div>
        `;
    }
    
    // عرض التفاصيل
    detailContent.innerHTML = `
        <div class="row">
            <div class="col-lg-8">
                ${imagesCarousel}
                <h2 class="mb-3">${property.title}</h2>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <p><strong><i class="bi bi-geo-alt-fill text-danger"></i> الموقع:</strong> ${property.location}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong><i class="bi bi-currency-exchange text-success"></i> السعر:</strong> ${property.price}</p>
                    </div>
                </div>
                <div class="mb-3">
                    <span class="badge bg-primary">${property.category}</span>
                </div>
                <div class="description-text mb-4">
                    ${property.description}
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-body text-center">
                        <h5 class="card-title">تواصل معنا</h5>
                        <p class="card-text">للاستفسار وتحديد موعد المعاينة</p>
                        <a href="https://wa.me/966555364095?text=مرحباً، أود الاستفسار عن ${encodeURIComponent(property.title)} في ${encodeURIComponent(property.location)}" 
                           class="btn btn-success btn-whatsapp w-100" target="_blank">
                            <i class="bi bi-whatsapp"></i> تواصل واتساب
                        </a>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // التمرير إلى أعلى الصفحة
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// العودة إلى قائمة العقارات
function backToListing() {
    const detailPage = document.getElementById('propertyDetailPage');
    const publicContent = document.getElementById('publicContent');
    
    if (detailPage && publicContent) {
        detailPage.style.display = 'none';
        publicContent.style.display = 'block';
    }
}

// تبديل لوحة تسجيل الدخول
function toggleLoginPanel() {
    const loginPanel = document.getElementById('loginPanel');
    
    if (isAdminLoggedIn) {
        performLogout();
    } else {
        if (loginPanel) {
            loginPanel.style.display = loginPanel.style.display === 'block' ? 'none' : 'block';
        }
    }
}

// تسجيل الدخول
function performLogin() {
    const username = document.getElementById('usernameInput').value;
    const password = document.getElementById('passwordInput').value;
    
    if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
        isAdminLoggedIn = true;
        document.getElementById('loginPanel').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        document.getElementById('loginLogoutBtn').textContent = 'تسجيل خروج';
        document.getElementById('publicContent').style.display = 'none';
        
        // تحديث جدول الإدارة
        updateAdminTable();
        
        showToast('تم تسجيل الدخول بنجاح', 'success');
    } else {
        showToast('اسم المستخدم أو كلمة المرور غير صحيحة', 'error');
    }
}

// تسجيل الخروج
function performLogout() {
    isAdminLoggedIn = false;
    document.getElementById('adminPanel').style.display = 'none';
    document.getElementById('publicContent').style.display = 'block';
    document.getElementById('loginLogoutBtn').textContent = 'دخول الإدارة';
    
    // إخفاء صفحة التفاصيل إذا كانت مفتوحة
    const detailPage = document.getElementById('propertyDetailPage');
    if (detailPage) {
        detailPage.style.display = 'none';
    }
    
    showToast('تم تسجيل الخروج بنجاح', 'info');
}

// تحديث جدول الإدارة
function updateAdminTable() {
    const tableBody = document.getElementById('adminTableBody');
    if (!tableBody) return;
    
    tableBody.innerHTML = '';
    
    properties.forEach(property => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${property.id}</td>
            <td>${property.title}</td>
            <td>${property.location}</td>
            <td>${property.price}</td>
            <td>${property.category}</td>
            <td>
                <span class="action-badge edit" onclick="editProperty(${property.id})">تحرير</span>
                <span class="action-badge delete" onclick="deleteProperty(${property.id})">حذف</span>
            </td>
        `;
        tableBody.appendChild(row);
    });
}

// تحرير العقار (للإدارة فقط)
function editProperty(propertyId) {
    const property = properties.find(p => p.id === propertyId);
    if (!property) return;
    
    document.getElementById('propertyId').value = property.id;
    document.getElementById('title').value = property.title;
    document.getElementById('location').value = property.location;
    document.getElementById('price').value = property.price.replace(' ريال', '').trim();
    document.getElementById('category').value = property.category;
    document.getElementById('description').value = property.description;
    
    showToast('تم تحميل بيانات العقار للتحرير', 'info');
}

// حذف العقار (للإدارة فقط)
function deleteProperty(propertyId) {
    if (confirm('هل أنت متأكد من حذف هذا العقار؟')) {
        const index = properties.findIndex(p => p.id === propertyId);
        if (index > -1) {
            properties.splice(index, 1);
            filteredProperties = [...properties];
            updateAdminTable();
            displayProperties();
            showToast('تم حذف العقار بنجاح', 'success');
        }
    }
}

// عرض الرسائل المنبثقة
function showToast(message, type) {
    const toastContainer = document.getElementById('toastContainer');
    if (!toastContainer) return;
    
    const toast = document.createElement('div');
    toast.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} alert-dismissible fade show`;
    toast.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    toastContainer.appendChild(toast);
    
    // إزالة الرسالة تلقائياً بعد 5 ثوان
    setTimeout(() => {
        if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
        }
    }, 5000);
}